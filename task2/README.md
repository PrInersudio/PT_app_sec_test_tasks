# Задание 2. Вычисления и лимитирование числа запросов.

## Ограничения решения:

- При большом лимите количества запросов и маленьком интервале возникают погрешности ограничителя запросов. Так, при 100 запросов в секунду возможна погрешность +-20. При 50 запросах в секунду проблем не наблюдалось.
- Хоть сервис и допускает возможность приёма JSON запросов, в которых дробные числа не обёрнуты в кавычки, делать этого не рекомендуется, так как это приводит к большой погрешности. Связано это с тем, что JSON Unmarshaler сначала переведёт такие числа в double, а только потом в decimal. Рекомендуется всегда в запросах передавать дробные числа в виде строк.
- В сервисе не реализована возможность включения маршалина JSON без кавычек. Так что надо учитывать, что дробные числа в ответе будут переданы в виде строк.
- Ограничение пакета decimal на 2^31 цифр после точки.

## Сборка и развёртывание.

### Файл конфигурации.

Для настройки сервиса ему надо передать в качестве параметра командной строки файл конфигурации в формате yaml. Пример файла конфигурации:

``` yaml
env: "local" # local, dev, prod
http_server:
  address: "localhost:8081"
  timeout: "4s" # время на принятие запроса и отправку ответа
  idle_timeout: "30s" # время простоя соединения
  stop_timeout: "10s" # время, через которое выключится сервер после получения SIGINT в случае наличия активных соединений
  rate limit:
    limit: 50
    interval: "1s" 
    msg: "Слишком много запросов."
```

### Установка и проверка необходимых зависимостей.

``` sh
go mod download && go mod verify
```

### Сборка и запуск бинарного файла.

``` sh
go build -o float_service.exe
./float_service.exe <файл с конфигурацией>
```

### Запуск с временным бинарным файлом.

``` sh
go run main.go <файл с конфигурацией>
```

### Тесты.

``` sh
go test ./...
```

## Примеры запросов и ответов.

- Передача в виде строк:
``` sh
curl -X GET -H "Content-Type: application/json" -d '{"X1":"1", "X2":"2", "X3":"3","Y1":"1","Y2":"2","Y3":"3","E":5}' localhost:8081 -w "%{http_code}\n"
{"status":"OK","X":"1.5","Y":"1.5","IsEqual":"T"}
200
```

- Передача целых чисел:
``` sh
curl -X GET -H "Content-Type: application/json" -d '{"X1":1, "X2":2, "X3":3,"Y1":1,"Y2":2,"Y3":3,"E":5}' localhost:8081 -w "%{http_code}\n"
{"status":"OK","X":"1.5","Y":"1.5","IsEqual":"T"}
200
```

- Передача дробных чисел:
``` sh
curl -X GET -H "Content-Type: application/json" -d '{"X1":1.1, "X2":2.2, "X3":3.3,"Y1":1.1,"Y2":2.2,"Y3":3.3,"E":5}' localhost:8081 -w "%{http_code}\n"
{"status":"OK","X":"1.65","Y":"1.65","IsEqual":"T"}
200
```

- Достигнут лимит запросов:
``` sh
curl -X GET -H "Content-Type: application/json" -d '{"X1":"1", "X2":"2", "X3":"3","Y1":"1","Y2":"2","Y3":"3","E":5}' localhost:8081 -w "%{http_code}\n"
{"status":"Error","error":"Слишком много запросов."}
402
```
